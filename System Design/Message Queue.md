## MQ를 직접 설계할 때 폴링을 어떻게 구현할 것인가

### Push model & Pull model

- 대부분의 MQ는 양쪽 모델을 모두 지원
- 폴링 기능은 특히 **Pull 모델**에서 핵심적인 부분

### Polling 방식

**Short Polling**

- 짧은 주기로 지속적인 메시지 확인
- 즉시 응답 확인 가능
- 메시지 빈도가 적은 경우 빈 응답이 많아져서 비효율적

**Long Polling**

- 긴 만료 시간이 끝나거나, 하나의 메시지를 수신받을 때까지 연결 유지
- 비용 효율적
- 메시지 도착 시 즉시 응답

⇒ ⭐️ 비용 효율적인 **Long Polling** 구현이 권장됨

### 추가 고려사항

- Back-off: 메시지를 발견하지 못한 경우 대기 시간을 점점 증가시키면서 비용 절약
- 멀티쓰레딩: 큐당 하나의 쓰레드를 사용하게 함으로써 멀티 큐를 효율적으로 처리 가능

### Kafka의 접근 방식

- 컨슈머가 브로커에 `fetch` 요청을 해서 폴링
- 로그의 오프셋을 함께 요청해서 해당 위치부터 시작하는 로그 청크를 수신 받음
- Long Polling 방식으로 비용 최적화
