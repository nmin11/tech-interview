## Rate Limiter

**개념**

- 시스템의 요청 비율을 제어하기 위한 알고리즘
- 한도 초과 요청을 차단해서 과부하를 방지하고 시스템 안정성을 보장
- DDoS 공격 등 악의적인 사용자로부터의 방어책

### Token Bucket Algorithm

- 개념
  - 고정된 용량의 버킷에 일정 속도로 꾸준히 토큰을 추가하고, 모든 요청마다 토큰을 소비하는 방식
  - 토큰이 남아있지 않은 경우 요청 거부
  - 주어진 시간 간격 내 요청률 제어 옵션을 통해 다양한 과부하 흐름을 처리할 수 있음
- 장점
  - 이해하고 실용하기에 편하다
  - 과부하 유형에 따라 유연하게 설정할 수 있다
- 단점
  - 토큰 생성 작업에 대한 세밀한 조정이 필요하다
  - 과부하 상황에선 좋지만 부하가 적으면 조정이 필요할 수 있다

**버스트 트래픽 허용이 필요한 경우**

### Leaky Bucket Algorithm

- 개념
  - 고정된 용량의 버킷이 누수되는 방식으로 요청 처리
  - 요청들은 버킷에 누적되고, 누수 속도가 따라잡지 못해서 버킷이 가득 차면 요청 거부
  - 요청 처리 속도를 트래픽 양과 상관 없이 동일하게 유지할 수 있음
- 장점
  - 사용자 혹은 애플리케이션에 대한 공정한 리소스 분배
  - 특정 유형의 DoS 공격 대비에 용이
- 단점
  - 토큰 관리 연산 로직이 필요해짐
  - rate limit의 속도 제한이 엄격해짐

**일정한 처리율이 중요한 경우**

### Fixed Window Algorithm

- 개념
  - 시간을 'window'라는 고정 간격으로 구분하고, 윈도우로 들어오는 요청을 제한하는 방식
  - 제한 초과 시 다음 윈도우까지는 처리될 수 없음
- 장점
  - 구현이 쉽다
  - 트래픽이 안정적인 경우 유용
- 단점
  - 윈도우의 경계 부분에서 과부하가 발생할 수 있다
  - 가변적인 부하 패턴에는 부적합

**단순한 구현 및 성능 우선**

### Sliding Window Algorithm

- 개념
  - fixed window 방식과 leaky bucket 방식의 혼합
  - 시간 프레임을 이동시키면서 해당 프레임 내의 요청 수를 제한하는 방식
  - 윈도우를 갱신하며 트래픽을 분산하는 세밀한 rate limiting 기법
- 장점
  - fixed window 방식보다 유연하다
  - 다양한 트래픽 유형을 다룰 수 있다
- 단점
  - 구현하기에 조금 복잡하다
  - 더 많은 연산 및 메모리가 필요하다

**세밀한 제어가 가능하지만 구현이 복잡**

⇒ 실무에서는 하이브리드 방식으로 혼합해서 사용하는 경우도 많다.

Reference

- [GeeksforGeeks - Rate Limiting Algorithms](https://www.geeksforgeeks.org/system-design/rate-limiting-algorithms-system-design)
